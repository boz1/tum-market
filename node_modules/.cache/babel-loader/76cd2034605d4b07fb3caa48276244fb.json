{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\JFrancisco\\\\Documents\\\\tum-market\\\\src\\\\components\\\\Home.js\";\nimport React, { Component } from 'react';\nimport firebase from '../config/firebaseConfig';\nimport { Switch, Route } from 'react-router-dom';\nimport Navbar from './Navbar';\nimport Footer from './Footer';\nimport AdvertisementList from './advertisement/AdvertisementList';\nimport AdDetails from './advertisement/AdDetails';\nimport PageNotFound from './PageNotFound';\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\";\nimport TradeList from './trade/TradeList';\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: {},\n      usersList: {},\n      advertisements: {},\n      categories: {},\n      conditions: {}\n    };\n    this.getUser = this.getUser.bind(this);\n    this.getUsers = this.getUsers.bind(this);\n    this.getAdvertisements = this.getAdvertisements.bind(this);\n    this.getCategories = this.getCategories.bind(this);\n    this.getConditions = this.getConditions.bind(this);\n  }\n\n  componentDidMount() {\n    this.getUsers();\n    this.getCategories();\n    this.getConditions();\n    this.getAdvertisements(this.props.user, this.getUser).catch(function (err) {\n      console.log(err);\n    });\n  }\n\n  componentWillUnmount() {\n    this.usersRef.off('value');\n    this.usersRef = null;\n    this.adsRef.off('value');\n    this.adsRef = null;\n    this.categoriesRef.off('value');\n    this.categoriesRef = null;\n    this.conditionsRef.off('value');\n    this.conditionsRef = null;\n    this.userRef.off('value');\n    this.userRef = null;\n    this.userAdsRef.off('value');\n    this.userAdsRef = null;\n    this.userBuyReqRef.off('value');\n    this.userBuyReqRef = null;\n    this.userTradeReqRefSent.off('value');\n    this.userTradeReqRefSent = null;\n    this.userTradeReqRefReceived.off('value');\n    this.userTradeReqRefReceived = null;\n  }\n\n  getUser(user) {\n    if (user !== undefined) {\n      const id = user.uid;\n      this.userRef = firebase.database().ref('users').child(id);\n      this.userRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.info = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userAdsRef = firebase.database().ref('advertisements').child(id);\n      this.userAdsRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.ads = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id);\n      this.userBuyReqRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.buyReq = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id);\n      this.userTradeReqRefSent.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.tradeReq = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id);\n      this.userTradeReqRefReceived.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.receivedOffers = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n    }\n  }\n\n  getUsers() {\n    this.usersRef = firebase.database().ref('users');\n    this.usersRef.on('value', snap => {\n      this.setState({\n        usersList: snap.val()\n      });\n    });\n  }\n\n  getAdvertisements(currentUser, cb) {\n    return new Promise((resolve, reject) => {\n      this.adsRef = firebase.database().ref('advertisements');\n      this.adsRef.on('value', snap => {\n        let data = snap.val();\n        let ads = [];\n        Object.keys(data).forEach(function (user) {\n          data[user].forEach(function (ad) {\n            const conRef = firebase.database().ref('conditions').child(ad.conditionId);\n            conRef.on('value', cond => {\n              ad.condition = cond.val();\n            });\n            const ownerRef = firebase.database().ref('users').child(ad.userId);\n            ownerRef.on('value', user => {\n              ad.user = user.val();\n            });\n            const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\n            mainCatRef.on('value', cat => {\n              const mainCat = cat.val();\n              ad.mainCategory = mainCat;\n              const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\n              subCatRef.on('value', sub => {\n                const subCat = sub.val();\n                ad.subCategory = subCat;\n              });\n            });\n            ads.push(ad);\n          });\n        });\n        this.setState({\n          advertisements: ads\n        });\n\n        if (this.state.advertisements.length !== undefined) {\n          resolve(cb(currentUser));\n        } else {\n          reject('ads error');\n        }\n      });\n    });\n  }\n\n  getCategories() {\n    this.categoriesRef = firebase.database().ref('categories');\n    this.categoriesRef.on('value', snap => {\n      this.setState({\n        categories: snap.val()\n      });\n    });\n  }\n\n  getConditions() {\n    this.conditionsRef = firebase.database().ref('conditions');\n    this.conditionsRef.on('value', snap => {\n      this.setState({\n        conditions: snap.val()\n      });\n    });\n  }\n\n  render() {\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(Navbar, {\n      user: this.state.user,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, React.createElement(Route, {\n      exact: true,\n      path: \"/\",\n      render: props => React.createElement(AdvertisementList, Object.assign({}, props, {\n        adsList: this.state.advertisements,\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/tradeRequests\",\n      render: props => React.createElement(TradeList, Object.assign({}, props, {\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/adDetails/:id\",\n      component: AdDetails,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/newAdvertisement\",\n      component: NewAdvertisement,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }), React.createElement(Route, {\n      component: PageNotFound,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    })), React.createElement(Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["C:\\Users\\JFrancisco\\Documents\\tum-market\\src\\components\\Home.js"],"names":["React","Component","firebase","Switch","Route","Navbar","Footer","AdvertisementList","AdDetails","PageNotFound","NewAdvertisement","TradeList","Home","constructor","props","state","user","usersList","advertisements","categories","conditions","getUser","bind","getUsers","getAdvertisements","getCategories","getConditions","componentDidMount","catch","err","console","log","componentWillUnmount","usersRef","off","adsRef","categoriesRef","conditionsRef","userRef","userAdsRef","userBuyReqRef","userTradeReqRefSent","userTradeReqRefReceived","undefined","id","uid","database","ref","child","on","snap","val","stateObj","info","setState","ads","buyReq","tradeReq","receivedOffers","currentUser","cb","Promise","resolve","reject","data","Object","keys","forEach","ad","conRef","conditionId","cond","condition","ownerRef","userId","mainCatRef","mainCategoryId","cat","mainCat","mainCategory","subCatRef","subCategoryId","sub","subCat","subCategory","push","length","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,QAAP,MAAqB,0BAArB;AACA,SAASC,MAAT,EAAiBC,KAAjB,QAA8B,kBAA9B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,iBAAP,MAA8B,mCAA9B;AACA,OAAOC,SAAP,MAAsB,2BAAtB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,OAAOC,gBAAP,MAA6B,kCAA7B;AACA,OAAOC,SAAP,MAAsB,mBAAtB;;AAEA,MAAMC,IAAN,SAAmBX,SAAnB,CAA6B;AAC3BY,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AAEA,SAAKC,KAAL,GAAa;AACXC,MAAAA,IAAI,EAAE,EADK;AAEXC,MAAAA,SAAS,EAAE,EAFA;AAGXC,MAAAA,cAAc,EAAE,EAHL;AAIXC,MAAAA,UAAU,EAAE,EAJD;AAKXC,MAAAA,UAAU,EAAE;AALD,KAAb;AAQA,SAAKC,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKE,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBF,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAKG,aAAL,GAAqB,KAAKA,aAAL,CAAmBH,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKI,aAAL,GAAqB,KAAKA,aAAL,CAAmBJ,IAAnB,CAAwB,IAAxB,CAArB;AACD;;AAEDK,EAAAA,iBAAiB,GAAG;AAClB,SAAKJ,QAAL;AACA,SAAKE,aAAL;AACA,SAAKC,aAAL;AACA,SAAKF,iBAAL,CAAuB,KAAKV,KAAL,CAAWE,IAAlC,EAAwC,KAAKK,OAA7C,EACGO,KADH,CACS,UAAUC,GAAV,EAAe;AAAEC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AAAkB,KAD5C;AAED;;AAEDG,EAAAA,oBAAoB,GAAG;AACrB,SAAKC,QAAL,CAAcC,GAAd,CAAkB,OAAlB;AACA,SAAKD,QAAL,GAAgB,IAAhB;AAEA,SAAKE,MAAL,CAAYD,GAAZ,CAAgB,OAAhB;AACA,SAAKC,MAAL,GAAc,IAAd;AAEA,SAAKC,aAAL,CAAmBF,GAAnB,CAAuB,OAAvB;AACA,SAAKE,aAAL,GAAqB,IAArB;AAEA,SAAKC,aAAL,CAAmBH,GAAnB,CAAuB,OAAvB;AACA,SAAKG,aAAL,GAAqB,IAArB;AAEA,SAAKC,OAAL,CAAaJ,GAAb,CAAiB,OAAjB;AACA,SAAKI,OAAL,GAAe,IAAf;AAEA,SAAKC,UAAL,CAAgBL,GAAhB,CAAoB,OAApB;AACA,SAAKK,UAAL,GAAkB,IAAlB;AAEA,SAAKC,aAAL,CAAmBN,GAAnB,CAAuB,OAAvB;AACA,SAAKM,aAAL,GAAqB,IAArB;AAEA,SAAKC,mBAAL,CAAyBP,GAAzB,CAA6B,OAA7B;AACA,SAAKO,mBAAL,GAA2B,IAA3B;AAEA,SAAKC,uBAAL,CAA6BR,GAA7B,CAAiC,OAAjC;AACA,SAAKQ,uBAAL,GAA+B,IAA/B;AACD;;AAEDrB,EAAAA,OAAO,CAACL,IAAD,EAAO;AACZ,QAAIA,IAAI,KAAK2B,SAAb,EAAwB;AACtB,YAAMC,EAAE,GAAG5B,IAAI,CAAC6B,GAAhB;AAEA,WAAKP,OAAL,GAAepC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,OAAxB,EAAiCC,KAAjC,CAAuCJ,EAAvC,CAAf;AACA,WAAKN,OAAL,CAAaW,EAAb,CAAgB,OAAhB,EAAyBC,IAAI,IAAI;AAC/B,YAAIC,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AACA,YAAIC,QAAQ,GAAG,KAAKrC,KAAL,CAAWC,IAA1B;AACAoC,QAAAA,QAAQ,CAACC,IAAT,GAAgBF,GAAhB;AACA,aAAKG,QAAL,CAAc;AACZtC,UAAAA,IAAI,EAAEoC;AADM,SAAd;AAGD,OAPD;AAUA,WAAKb,UAAL,GAAkBrC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,gBAAxB,EAA0CC,KAA1C,CAAgDJ,EAAhD,CAAlB;AACA,WAAKL,UAAL,CAAgBU,EAAhB,CAAmB,OAAnB,EAA4BC,IAAI,IAAI;AAClC,YAAIC,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AACA,YAAIC,QAAQ,GAAG,KAAKrC,KAAL,CAAWC,IAA1B;AACAoC,QAAAA,QAAQ,CAACG,GAAT,GAAeJ,GAAf;AACA,aAAKG,QAAL,CAAc;AACZtC,UAAAA,IAAI,EAAEoC;AADM,SAAd;AAGD,OAPD;AASA,WAAKZ,aAAL,GAAqBtC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,iBAAxB,EAA2CC,KAA3C,CAAiDJ,EAAjD,CAArB;AACA,WAAKJ,aAAL,CAAmBS,EAAnB,CAAsB,OAAtB,EAA+BC,IAAI,IAAI;AACrC,YAAIC,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AACA,YAAIC,QAAQ,GAAG,KAAKrC,KAAL,CAAWC,IAA1B;AACAoC,QAAAA,QAAQ,CAACI,MAAT,GAAkBL,GAAlB;AACA,aAAKG,QAAL,CAAc;AACZtC,UAAAA,IAAI,EAAEoC;AADM,SAAd;AAGD,OAPD;AASA,WAAKX,mBAAL,GAA2BvC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,gBAAxB,EAA0CC,KAA1C,CAAgDJ,EAAhD,CAA3B;AACA,WAAKH,mBAAL,CAAyBQ,EAAzB,CAA4B,OAA5B,EAAqCC,IAAI,IAAI;AAC3C,YAAIC,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AACA,YAAIC,QAAQ,GAAG,KAAKrC,KAAL,CAAWC,IAA1B;AACAoC,QAAAA,QAAQ,CAACK,QAAT,GAAoBN,GAApB;AACA,aAAKG,QAAL,CAAc;AACZtC,UAAAA,IAAI,EAAEoC;AADM,SAAd;AAGD,OAPD;AASA,WAAKV,uBAAL,GAA+BxC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,iBAAxB,EAA2CC,KAA3C,CAAiDJ,EAAjD,CAA/B;AACA,WAAKF,uBAAL,CAA6BO,EAA7B,CAAgC,OAAhC,EAAyCC,IAAI,IAAI;AAC/C,YAAIC,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AACA,YAAIC,QAAQ,GAAG,KAAKrC,KAAL,CAAWC,IAA1B;AACAoC,QAAAA,QAAQ,CAACM,cAAT,GAA0BP,GAA1B;AACA,aAAKG,QAAL,CAAc;AACZtC,UAAAA,IAAI,EAAEoC;AADM,SAAd;AAGD,OAPD;AAQD;AACF;;AAED7B,EAAAA,QAAQ,GAAG;AACT,SAAKU,QAAL,GAAgB/B,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,OAAxB,CAAhB;AACA,SAAKd,QAAL,CAAcgB,EAAd,CAAiB,OAAjB,EAA0BC,IAAI,IAAI;AAChC,WAAKI,QAAL,CAAc;AACZrC,QAAAA,SAAS,EAAEiC,IAAI,CAACC,GAAL;AADC,OAAd;AAGD,KAJD;AAKD;;AAED3B,EAAAA,iBAAiB,CAACmC,WAAD,EAAcC,EAAd,EAAkB;AACjC,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAK5B,MAAL,GAAcjC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,gBAAxB,CAAd;AACA,WAAKZ,MAAL,CAAYc,EAAZ,CAAe,OAAf,EAAwBC,IAAI,IAAI;AAC9B,YAAIc,IAAI,GAAGd,IAAI,CAACC,GAAL,EAAX;AACA,YAAII,GAAG,GAAG,EAAV;AACAU,QAAAA,MAAM,CAACC,IAAP,CAAYF,IAAZ,EAAkBG,OAAlB,CAA0B,UAAUnD,IAAV,EAAgB;AACxCgD,UAAAA,IAAI,CAAChD,IAAD,CAAJ,CAAWmD,OAAX,CAAmB,UAAUC,EAAV,EAAc;AAC/B,kBAAMC,MAAM,GAAGnE,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,YAAxB,EAAsCC,KAAtC,CAA4CoB,EAAE,CAACE,WAA/C,CAAf;AACAD,YAAAA,MAAM,CAACpB,EAAP,CAAU,OAAV,EAAmBsB,IAAI,IAAI;AACzBH,cAAAA,EAAE,CAACI,SAAH,GAAeD,IAAI,CAACpB,GAAL,EAAf;AACD,aAFD;AAIA,kBAAMsB,QAAQ,GAAGvE,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,OAAxB,EAAiCC,KAAjC,CAAuCoB,EAAE,CAACM,MAA1C,CAAjB;AACAD,YAAAA,QAAQ,CAACxB,EAAT,CAAY,OAAZ,EAAqBjC,IAAI,IAAI;AAC3BoD,cAAAA,EAAE,CAACpD,IAAH,GAAUA,IAAI,CAACmC,GAAL,EAAV;AACD,aAFD;AAIA,kBAAMwB,UAAU,GAAGzE,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,YAAxB,EAAsCC,KAAtC,CAA4CoB,EAAE,CAACQ,cAA/C,CAAnB;AACAD,YAAAA,UAAU,CAAC1B,EAAX,CAAc,OAAd,EAAuB4B,GAAG,IAAI;AAC5B,oBAAMC,OAAO,GAAGD,GAAG,CAAC1B,GAAJ,EAAhB;AACAiB,cAAAA,EAAE,CAACW,YAAH,GAAkBD,OAAlB;AACA,oBAAME,SAAS,GAAG9E,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,gBAAxB,EAA0CC,KAA1C,CAAgDoB,EAAE,CAACQ,cAAnD,EAAmE5B,KAAnE,CAAyEoB,EAAE,CAACa,aAA5E,CAAlB;AACAD,cAAAA,SAAS,CAAC/B,EAAV,CAAa,OAAb,EAAsBiC,GAAG,IAAI;AAC3B,sBAAMC,MAAM,GAAGD,GAAG,CAAC/B,GAAJ,EAAf;AACAiB,gBAAAA,EAAE,CAACgB,WAAH,GAAiBD,MAAjB;AACD,eAHD;AAID,aARD;AASA5B,YAAAA,GAAG,CAAC8B,IAAJ,CAASjB,EAAT;AACD,WAtBD;AAuBD,SAxBD;AA0BA,aAAKd,QAAL,CAAc;AACZpC,UAAAA,cAAc,EAAEqC;AADJ,SAAd;;AAIA,YAAI,KAAKxC,KAAL,CAAWG,cAAX,CAA0BoE,MAA1B,KAAqC3C,SAAzC,EAAoD;AAClDmB,UAAAA,OAAO,CAACF,EAAE,CAACD,WAAD,CAAH,CAAP;AACD,SAFD,MAGK;AACHI,UAAAA,MAAM,CAAC,WAAD,CAAN;AACD;AAEF,OAxCD;AAyCD,KA3CM,CAAP;AA4CD;;AAEDtC,EAAAA,aAAa,GAAG;AACd,SAAKW,aAAL,GAAqBlC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,YAAxB,CAArB;AACA,SAAKX,aAAL,CAAmBa,EAAnB,CAAsB,OAAtB,EAA+BC,IAAI,IAAI;AACrC,WAAKI,QAAL,CAAc;AACZnC,QAAAA,UAAU,EAAE+B,IAAI,CAACC,GAAL;AADA,OAAd;AAGD,KAJD;AAKD;;AAEDzB,EAAAA,aAAa,GAAG;AACd,SAAKW,aAAL,GAAqBnC,QAAQ,CAAC4C,QAAT,GAAoBC,GAApB,CAAwB,YAAxB,CAArB;AACA,SAAKV,aAAL,CAAmBY,EAAnB,CAAsB,OAAtB,EAA+BC,IAAI,IAAI;AACrC,WAAKI,QAAL,CAAc;AACZlC,QAAAA,UAAU,EAAE8B,IAAI,CAACC,GAAL;AADA,OAAd;AAGD,KAJD;AAKD;;AAEDoC,EAAAA,MAAM,GAAG;AACP,WACE,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,MAAD;AAAQ,MAAA,IAAI,EAAE,KAAKxE,KAAL,CAAWC,IAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,EAEE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,KAAD;AAAO,MAAA,KAAK,MAAZ;AAAa,MAAA,IAAI,EAAC,GAAlB;AAAsB,MAAA,MAAM,EAAGF,KAAD,IAAW,oBAAC,iBAAD,oBAAuBA,KAAvB;AAA8B,QAAA,OAAO,EAAE,KAAKC,KAAL,CAAWG,cAAlD;AAAkE,QAAA,IAAI,EAAE,KAAKH,KAAL,CAAWC,IAAnF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,EAEE,oBAAC,KAAD;AAAO,MAAA,IAAI,EAAC,gBAAZ;AAA6B,MAAA,MAAM,EAAGF,KAAD,IAAW,oBAAC,SAAD,oBAAeA,KAAf;AAAsB,QAAA,IAAI,EAAE,KAAKC,KAAL,CAAWC,IAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,EAGE,oBAAC,KAAD;AAAO,MAAA,IAAI,EAAC,gBAAZ;AAA6B,MAAA,SAAS,EAAER,SAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHF,EAIE,oBAAC,KAAD;AAAO,MAAA,IAAI,EAAC,mBAAZ;AAAgC,MAAA,SAAS,EAAEE,gBAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJF,EAKE,oBAAC,KAAD;AAAO,MAAA,SAAS,EAAED,YAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MALF,CAFF,EASE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MATF,CADF,CADF;AAeD;;AA3M0B;;AA8M7B,eAAeG,IAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport firebase from '../config/firebaseConfig';\r\nimport { Switch, Route } from 'react-router-dom'\r\nimport Navbar from './Navbar'\r\nimport Footer from './Footer'\r\nimport AdvertisementList from './advertisement/AdvertisementList'\r\nimport AdDetails from './advertisement/AdDetails'\r\nimport PageNotFound from './PageNotFound'\r\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\"\r\nimport TradeList from './trade/TradeList'\r\n\r\nclass Home extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      user: {},\r\n      usersList: {},\r\n      advertisements: {},\r\n      categories: {},\r\n      conditions: {}\r\n    }\r\n\r\n    this.getUser = this.getUser.bind(this)\r\n    this.getUsers = this.getUsers.bind(this)\r\n    this.getAdvertisements = this.getAdvertisements.bind(this)\r\n    this.getCategories = this.getCategories.bind(this)\r\n    this.getConditions = this.getConditions.bind(this)\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getUsers()\r\n    this.getCategories()\r\n    this.getConditions()\r\n    this.getAdvertisements(this.props.user, this.getUser)\r\n      .catch(function (err) { console.log(err) })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.usersRef.off('value')\r\n    this.usersRef = null;\r\n\r\n    this.adsRef.off('value')\r\n    this.adsRef = null;\r\n\r\n    this.categoriesRef.off('value')\r\n    this.categoriesRef = null;\r\n\r\n    this.conditionsRef.off('value')\r\n    this.conditionsRef = null;\r\n\r\n    this.userRef.off('value')\r\n    this.userRef = null;\r\n\r\n    this.userAdsRef.off('value')\r\n    this.userAdsRef = null;\r\n\r\n    this.userBuyReqRef.off('value')\r\n    this.userBuyReqRef = null;\r\n\r\n    this.userTradeReqRefSent.off('value')\r\n    this.userTradeReqRefSent = null;\r\n\r\n    this.userTradeReqRefReceived.off('value')\r\n    this.userTradeReqRefReceived = null;\r\n  }\r\n\r\n  getUser(user) {\r\n    if (user !== undefined) {\r\n      const id = user.uid;\r\n\r\n      this.userRef = firebase.database().ref('users').child(id)\r\n      this.userRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.info = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n\r\n      this.userAdsRef = firebase.database().ref('advertisements').child(id)\r\n      this.userAdsRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.ads = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id)\r\n      this.userBuyReqRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.buyReq = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id)\r\n      this.userTradeReqRefSent.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.tradeReq = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n\r\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id)\r\n      this.userTradeReqRefReceived.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.receivedOffers = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  getUsers() {\r\n    this.usersRef = firebase.database().ref('users')\r\n    this.usersRef.on('value', snap => {\r\n      this.setState({\r\n        usersList: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getAdvertisements(currentUser, cb) {\r\n    return new Promise((resolve, reject) => {\r\n      this.adsRef = firebase.database().ref('advertisements')\r\n      this.adsRef.on('value', snap => {\r\n        let data = snap.val();\r\n        let ads = [];\r\n        Object.keys(data).forEach(function (user) {\r\n          data[user].forEach(function (ad) {\r\n            const conRef = firebase.database().ref('conditions').child(ad.conditionId);\r\n            conRef.on('value', cond => {\r\n              ad.condition = cond.val()\r\n            })\r\n\r\n            const ownerRef = firebase.database().ref('users').child(ad.userId);\r\n            ownerRef.on('value', user => {\r\n              ad.user = user.val()\r\n            })\r\n\r\n            const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\r\n            mainCatRef.on('value', cat => {\r\n              const mainCat = cat.val()\r\n              ad.mainCategory = mainCat;\r\n              const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\r\n              subCatRef.on('value', sub => {\r\n                const subCat = sub.val();\r\n                ad.subCategory = subCat;\r\n              })\r\n            })\r\n            ads.push(ad)\r\n          })\r\n        });\r\n\r\n        this.setState({\r\n          advertisements: ads\r\n        })\r\n\r\n        if (this.state.advertisements.length !== undefined) {\r\n          resolve(cb(currentUser))\r\n        }\r\n        else {\r\n          reject('ads error')\r\n        }\r\n\r\n      })\r\n    })\r\n  }\r\n\r\n  getCategories() {\r\n    this.categoriesRef = firebase.database().ref('categories')\r\n    this.categoriesRef.on('value', snap => {\r\n      this.setState({\r\n        categories: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getConditions() {\r\n    this.conditionsRef = firebase.database().ref('conditions')\r\n    this.conditionsRef.on('value', snap => {\r\n      this.setState({\r\n        conditions: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"container\">\r\n          <Navbar user={this.state.user} />\r\n          <Switch>\r\n            <Route exact path=\"/\" render={(props) => <AdvertisementList {...props} adsList={this.state.advertisements} user={this.state.user} />} />\r\n            <Route path=\"/tradeRequests\" render={(props) => <TradeList {...props} user={this.state.user}/>} />\r\n            <Route path=\"/adDetails/:id\" component={AdDetails} />\r\n            <Route path=\"/newAdvertisement\" component={NewAdvertisement} />\r\n            <Route component={PageNotFound} />\r\n          </Switch>\r\n          <Footer />\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}