{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\JFrancisco\\\\Documents\\\\tum-market\\\\src\\\\components\\\\Home.js\";\nimport React, { Component } from 'react';\nimport firebase from '../config/firebaseConfig';\nimport { Switch, Route } from 'react-router-dom';\nimport Navbar from './Navbar';\nimport Footer from './Footer';\nimport AdvertisementList from './advertisement/AdvertisementList';\nimport AdDetails from './advertisement/AdDetails';\nimport PageNotFound from './PageNotFound';\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\";\nimport TradeList from './trade/TradeList';\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: {},\n      usersList: {},\n      advertisements: {},\n      sug: {},\n      categories: {},\n      conditions: {},\n      notifications: {}\n    };\n    this.getUser = this.getUser.bind(this);\n    this.getUsers = this.getUsers.bind(this);\n    this.getAdvertisements = this.getAdvertisements.bind(this);\n    this.getCategories = this.getCategories.bind(this);\n    this.getConditions = this.getConditions.bind(this);\n    this.search = this.search.bind(this);\n  }\n\n  componentDidMount() {\n    this.getUsers();\n    this.getCategories();\n    this.getConditions();\n    this.getAdvertisements(this.props.user, this.getUser).catch(function (err) {\n      console.log(err);\n    });\n  }\n\n  componentWillUnmount() {\n    this.usersRef.off('value');\n    this.usersRef = null;\n    this.adsRef.off('value');\n    this.adsRef = null;\n    this.categoriesRef.off('value');\n    this.categoriesRef = null;\n    this.conditionsRef.off('value');\n    this.conditionsRef = null;\n    this.userRef.off('value');\n    this.userRef = null;\n    this.userAdsRef.off('value');\n    this.userAdsRef = null;\n    this.userBuyReqRef.off('value');\n    this.userBuyReqRef = null;\n    this.userTradeReqRefSent.off('value');\n    this.userTradeReqRefSent = null;\n    this.userTradeReqRefReceived.off('value');\n    this.userTradeReqRefReceived = null;\n  }\n\n  getUser(user) {\n    if (user !== undefined) {\n      const id = user.uid;\n      this.userRef = firebase.database().ref('users').child(id);\n      this.userRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.info = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userAdsRef = firebase.database().ref('advertisements').child(id);\n      this.userAdsRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.ads = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id);\n      this.userBuyReqRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.buyReq = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id);\n      this.userTradeReqRefSent.on('value', snap => {\n        var data = [];\n        snap.forEach(ss => {\n          data.push(ss.val());\n        });\n        let stateObj = this.state.user;\n        stateObj.tradeReq = data;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id);\n      this.userTradeReqRefReceived.on('value', snap => {\n        var data = [];\n        snap.forEach(ss => {\n          data.push(ss.val());\n        });\n        let stateObj = this.state.user;\n        stateObj.receivedOffers = data;\n        this.setState({\n          user: stateObj\n        });\n      });\n    }\n  }\n\n  getUsers() {\n    this.usersRef = firebase.database().ref('users');\n    this.usersRef.on('value', snap => {\n      this.setState({\n        usersList: snap.val()\n      });\n    });\n  }\n\n  getAdvertisements(currentUser, cb) {\n    return new Promise((resolve, reject) => {\n      this.adsRef = firebase.database().ref('advertisements');\n      this.adsRef.on('value', snap => {\n        let data = snap.val();\n        let ads = [];\n        Object.keys(data).forEach(function (user) {\n          data[user].forEach(function (ad) {\n            const conRef = firebase.database().ref('conditions').child(ad.conditionId);\n            conRef.on('value', cond => {\n              ad.condition = cond.val();\n            });\n            const ownerRef = firebase.database().ref('users').child(ad.userId);\n            ownerRef.on('value', user => {\n              ad.user = user.val();\n            });\n            const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\n            mainCatRef.on('value', cat => {\n              const mainCat = cat.val();\n              ad.mainCategory = mainCat;\n              const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\n              subCatRef.on('value', sub => {\n                const subCat = sub.val();\n                ad.subCategory = subCat;\n              });\n            });\n            ads.push(ad);\n          });\n        });\n        this.setState({\n          advertisements: ads,\n          sug: ads\n        });\n\n        if (this.state.advertisements.length !== undefined) {\n          resolve(cb(currentUser));\n        } else {\n          reject('ads error');\n        }\n      });\n    });\n  }\n\n  getCategories() {\n    this.categoriesRef = firebase.database().ref('categories');\n    this.categoriesRef.on('value', snap => {\n      this.setState({\n        categories: snap.val()\n      });\n    });\n  }\n\n  getConditions() {\n    this.conditionsRef = firebase.database().ref('conditions');\n    this.conditionsRef.on('value', snap => {\n      this.setState({\n        conditions: snap.val()\n      });\n    });\n  }\n\n  search(input) {\n    if (input.target.value.length === 0) this.setState({\n      sug: this.state.advertisements\n    });else {\n      const regix = new RegExp(\"\".concat(input.target.value), 'i');\n      this.setState({\n        sug: this.state.advertisements.filter(ad => regix.test(ad.title))\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, React.createElement(Navbar, {\n      search: this.search,\n      user: this.state.user,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, React.createElement(Route, {\n      exact: true,\n      path: \"/\",\n      render: props => React.createElement(AdvertisementList, Object.assign({}, props, {\n        adsList: this.state.advertisements,\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/tradeRequests\",\n      render: props => React.createElement(TradeList, Object.assign({}, props, {\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/adDetails/:id\",\n      component: AdDetails,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/newAdvertisement\",\n      component: NewAdvertisement,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }), React.createElement(Route, {\n      component: PageNotFound,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    })), React.createElement(Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["C:\\Users\\JFrancisco\\Documents\\tum-market\\src\\components\\Home.js"],"names":["React","Component","firebase","Switch","Route","Navbar","Footer","AdvertisementList","AdDetails","PageNotFound","NewAdvertisement","TradeList","Home","constructor","props","state","user","usersList","advertisements","sug","categories","conditions","notifications","getUser","bind","getUsers","getAdvertisements","getCategories","getConditions","search","componentDidMount","catch","err","console","log","componentWillUnmount","usersRef","off","adsRef","categoriesRef","conditionsRef","userRef","userAdsRef","userBuyReqRef","userTradeReqRefSent","userTradeReqRefReceived","undefined","id","uid","database","ref","child","on","snap","val","stateObj","info","setState","ads","buyReq","data","forEach","ss","push","tradeReq","receivedOffers","currentUser","cb","Promise","resolve","reject","Object","keys","ad","conRef","conditionId","cond","condition","ownerRef","userId","mainCatRef","mainCategoryId","cat","mainCat","mainCategory","subCatRef","subCategoryId","sub","subCat","subCategory","length","input","target","value","regix","RegExp","filter","test","title","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport firebase from '../config/firebaseConfig';\r\nimport { Switch, Route } from 'react-router-dom'\r\nimport Navbar from './Navbar'\r\nimport Footer from './Footer'\r\nimport AdvertisementList from './advertisement/AdvertisementList'\r\nimport AdDetails from './advertisement/AdDetails'\r\nimport PageNotFound from './PageNotFound'\r\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\"\r\nimport TradeList from './trade/TradeList'\r\n\r\n\r\nclass Home extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      user: {},\r\n      usersList: {},\r\n      advertisements: {},\r\n      sug: {},\r\n      categories: {},\r\n      conditions: {},\r\n      notifications: {}\r\n    }\r\n\r\n    this.getUser = this.getUser.bind(this)\r\n    this.getUsers = this.getUsers.bind(this)\r\n    this.getAdvertisements = this.getAdvertisements.bind(this)\r\n    this.getCategories = this.getCategories.bind(this)\r\n    this.getConditions = this.getConditions.bind(this)\r\n    this.search = this.search.bind(this);\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getUsers()\r\n    this.getCategories()\r\n    this.getConditions()\r\n    this.getAdvertisements(this.props.user, this.getUser)\r\n      .catch(function (err) { console.log(err) })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.usersRef.off('value')\r\n    this.usersRef = null;\r\n\r\n    this.adsRef.off('value')\r\n    this.adsRef = null;\r\n\r\n    this.categoriesRef.off('value')\r\n    this.categoriesRef = null;\r\n\r\n    this.conditionsRef.off('value')\r\n    this.conditionsRef = null;\r\n\r\n    this.userRef.off('value')\r\n    this.userRef = null;\r\n\r\n    this.userAdsRef.off('value')\r\n    this.userAdsRef = null;\r\n\r\n    this.userBuyReqRef.off('value')\r\n    this.userBuyReqRef = null;\r\n\r\n    this.userTradeReqRefSent.off('value')\r\n    this.userTradeReqRefSent = null;\r\n\r\n    this.userTradeReqRefReceived.off('value')\r\n    this.userTradeReqRefReceived = null;\r\n  }\r\n\r\n  getUser(user) {\r\n    if (user !== undefined) {\r\n      const id = user.uid;\r\n\r\n      this.userRef = firebase.database().ref('users').child(id)\r\n      this.userRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.info = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userAdsRef = firebase.database().ref('advertisements').child(id)\r\n      this.userAdsRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.ads = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id)\r\n      this.userBuyReqRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.buyReq = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id)\r\n      this.userTradeReqRefSent.on('value', snap => {\r\n        var data = [];\r\n        snap.forEach(ss => {\r\n          data.push(ss.val());\r\n        });\r\n\r\n        let stateObj = this.state.user;\r\n        stateObj.tradeReq = data;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n\r\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id)\r\n      this.userTradeReqRefReceived.on('value', snap => {\r\n        var data = [];\r\n        snap.forEach(ss => {\r\n          data.push(ss.val());\r\n        });\r\n\r\n        let stateObj = this.state.user;\r\n        stateObj.receivedOffers = data;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  getUsers() {\r\n    this.usersRef = firebase.database().ref('users')\r\n    this.usersRef.on('value', snap => {\r\n      this.setState({\r\n        usersList: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getAdvertisements(currentUser, cb) {\r\n    return new Promise((resolve, reject) => {\r\n      this.adsRef = firebase.database().ref('advertisements')\r\n      this.adsRef.on('value', snap => {\r\n        let data = snap.val();\r\n        let ads = [];\r\n        Object.keys(data).forEach(function (user) {\r\n          data[user].forEach(function (ad) {\r\n            const conRef = firebase.database().ref('conditions').child(ad.conditionId);\r\n            conRef.on('value', cond => {\r\n              ad.condition = cond.val()\r\n            })\r\n\r\n            const ownerRef = firebase.database().ref('users').child(ad.userId);\r\n            ownerRef.on('value', user => {\r\n              ad.user = user.val()\r\n            })\r\n\r\n            const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\r\n            mainCatRef.on('value', cat => {\r\n              const mainCat = cat.val()\r\n              ad.mainCategory = mainCat;\r\n              const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\r\n              subCatRef.on('value', sub => {\r\n                const subCat = sub.val();\r\n                ad.subCategory = subCat;\r\n              })\r\n            })\r\n            ads.push(ad)\r\n          })\r\n        });\r\n\r\n        this.setState({\r\n          advertisements: ads,\r\n          sug: ads\r\n        })\r\n\r\n        if (this.state.advertisements.length !== undefined) {\r\n          resolve(cb(currentUser))\r\n        }\r\n        else {\r\n          reject('ads error')\r\n        }\r\n\r\n      })\r\n    })\r\n  }\r\n\r\n  getCategories() {\r\n    this.categoriesRef = firebase.database().ref('categories')\r\n    this.categoriesRef.on('value', snap => {\r\n      this.setState({\r\n        categories: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getConditions() {\r\n    this.conditionsRef = firebase.database().ref('conditions')\r\n    this.conditionsRef.on('value', snap => {\r\n      this.setState({\r\n        conditions: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  search(input) {\r\n    if (input.target.value.length === 0)\r\n      this.setState({ sug: this.state.advertisements })\r\n    else {\r\n      const regix = new RegExp(`${input.target.value}`, 'i')\r\n      this.setState({ sug: this.state.advertisements.filter(ad => regix.test(ad.title)) })\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"container content\">\r\n          <Navbar search={this.search} user={this.state.user} />\r\n          <Switch>\r\n            <Route exact path=\"/\" render={(props) => <AdvertisementList {...props} adsList={this.state.advertisements} user={this.state.user} />} />\r\n            <Route path=\"/tradeRequests\" render={(props) => <TradeList {...props} user={this.state.user} />} />\r\n            <Route path=\"/adDetails/:id\" component={AdDetails} />\r\n            <Route path=\"/newAdvertisement\" component={NewAdvertisement} />\r\n            <Route component={PageNotFound} />\r\n          </Switch>\r\n          <Footer />\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}