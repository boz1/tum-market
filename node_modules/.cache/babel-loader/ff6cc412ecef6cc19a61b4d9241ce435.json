{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\JFrancisco\\\\Documents\\\\tum-market\\\\src\\\\components\\\\Home.js\";\nimport React, { Component } from 'react';\nimport firebase from '../config/firebaseConfig';\nimport { Switch, Route } from 'react-router-dom';\nimport Navbar from './Navbar';\nimport Footer from './Footer';\nimport Marketplace from './advertisement/Marketplace';\nimport AdDetails from './advertisement/AdDetails';\nimport PageNotFound from './PageNotFound';\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\";\nimport TradeList from './trade/TradeList';\nimport MyAds from './advertisement/MyAds';\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n\n    this.filterUserAds = () => {\n      let ads = [];\n\n      if (this.state.user !== undefined && Object.values(this.state.user).length !== 0) {\n        const id = this.state.user.info.id;\n        ads = Object.values(this.state.advertisements).filter(function (ad) {\n          return ad.userId === id;\n        });\n      }\n\n      return ads;\n    };\n\n    this.state = {\n      user: {},\n      usersList: {},\n      advertisements: {},\n      sug: {},\n      categories: {},\n      subCategories: {},\n      conditions: {}\n    };\n    this.getUser = this.getUser.bind(this);\n    this.getUsers = this.getUsers.bind(this);\n    this.getAdvertisements = this.getAdvertisements.bind(this);\n    this.getCategories = this.getCategories.bind(this);\n    this.getSubCategories = this.getSubCategories.bind(this);\n    this.getConditions = this.getConditions.bind(this);\n    this.search = this.search.bind(this);\n  }\n\n  componentDidMount() {\n    this.getUsers();\n    this.getCategories();\n    this.getSubCategories();\n    this.getConditions();\n    this.getAdvertisements(this.props.user, this.getUser).catch(function (err) {\n      console.log(err);\n    });\n  }\n\n  componentWillUnmount() {\n    this.usersRef.off('value');\n    this.usersRef = null;\n    this.adsRef.off('value');\n    this.adsRef = null;\n    this.categoriesRef.off('value');\n    this.categoriesRef = null;\n    this.subCategoriesRef.off('value');\n    this.subCategoriesRef = null;\n    this.conditionsRef.off('value');\n    this.conditionsRef = null;\n    this.userRef.off('value');\n    this.userRef = null;\n    this.userAdsRef.off('value');\n    this.userAdsRef = null;\n    this.userBuyReqRef.off('value');\n    this.userBuyReqRef = null;\n    this.userTradeReqRefSent.off('value');\n    this.userTradeReqRefSent = null;\n    this.userTradeReqRefReceived.off('value');\n    this.userTradeReqRefReceived = null;\n  }\n\n  getUser(user) {\n    if (user !== undefined) {\n      const id = user.uid;\n      this.userRef = firebase.database().ref('users').child(id);\n      this.userRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.info = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userAdsRef = firebase.database().ref('advertisements').child(id);\n      this.userAdsRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.ads = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id);\n      this.userBuyReqRef.on('value', snap => {\n        let val = snap.val();\n        let stateObj = this.state.user;\n        stateObj.buyReq = val;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id);\n      this.userTradeReqRefSent.on('value', snap => {\n        var data = [];\n        snap.forEach(ss => {\n          data.push(ss.val());\n        });\n        let stateObj = this.state.user;\n        stateObj.tradeReq = data;\n        this.setState({\n          user: stateObj\n        });\n      });\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id);\n      this.userTradeReqRefReceived.on('value', snap => {\n        var data = [];\n        snap.forEach(ss => {\n          data.push(ss.val());\n        });\n        let stateObj = this.state.user;\n        stateObj.receivedOffers = data;\n        this.setState({\n          user: stateObj\n        });\n      });\n    }\n  }\n\n  getUsers() {\n    this.usersRef = firebase.database().ref('users');\n    this.usersRef.on('value', snap => {\n      this.setState({\n        usersList: snap.val()\n      });\n    });\n  }\n\n  getAdvertisements(currentUser, cb) {\n    return new Promise((resolve, reject) => {\n      this.adsRef = firebase.database().ref('advertisements');\n      this.adsRef.on('value', snap => {\n        let data = snap.val();\n        let ads = [];\n\n        if (data !== null && data !== undefined) {\n          Object.keys(data).forEach(function (user) {\n            Object.values(data[user]).forEach(function (ad) {\n              const conRef = firebase.database().ref('conditions').child(ad.conditionId);\n              conRef.on('value', cond => {\n                ad.condition = cond.val();\n              });\n              const ownerRef = firebase.database().ref('users').child(ad.userId);\n              ownerRef.on('value', user => {\n                ad.user = user.val();\n              });\n              const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\n              mainCatRef.on('value', cat => {\n                const mainCat = cat.val();\n                ad.mainCategory = mainCat;\n                const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\n                subCatRef.on('value', sub => {\n                  const subCat = sub.val();\n                  ad.subCategory = subCat;\n                });\n              });\n              ads.push(ad);\n            });\n          });\n        }\n\n        this.setState({\n          advertisements: ads,\n          sug: ads\n        });\n\n        if (this.state.advertisements.length !== undefined) {\n          resolve(cb(currentUser));\n        } else {\n          reject('ads error');\n        }\n      });\n    });\n  }\n\n  getCategories() {\n    this.categoriesRef = firebase.database().ref('categories');\n    this.categoriesRef.on('value', snap => {\n      this.setState({\n        categories: snap.val()\n      });\n    });\n  }\n\n  getSubCategories() {\n    this.subCategoriesRef = firebase.database().ref('sub-categories');\n    this.subCategoriesRef.on('value', snap => {\n      this.setState({\n        subCategories: snap.val()\n      });\n    });\n  }\n\n  getConditions() {\n    this.conditionsRef = firebase.database().ref('conditions');\n    this.conditionsRef.on('value', snap => {\n      this.setState({\n        conditions: snap.val()\n      });\n    });\n  }\n\n  search(input) {\n    if (input.target.value.length === 0) this.setState({\n      sug: this.state.advertisements\n    }, () => this.forceUpdate());else {\n      const regix = new RegExp(\"\".concat(input.target.value), 'i');\n      this.setState({\n        sug: this.state.advertisements.filter(ad => regix.test(ad.title))\n      }, () => this.forceUpdate());\n    }\n  }\n\n  render() {\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container\",\n      style: {\n        background: \"#e9ebee\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253\n      },\n      __self: this\n    }, React.createElement(Navbar, {\n      search: this.search,\n      user: this.state.user,\n      categories: this.state.categories,\n      subCategories: this.state.subCategories,\n      conditions: this.state.conditions,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, React.createElement(Route, {\n      exact: true,\n      path: \"/\",\n      render: props => React.createElement(Marketplace, Object.assign({}, props, {\n        adsList: this.state.sug,\n        user: this.state.user,\n        categories: this.state.categories,\n        subCategories: this.state.subCategories,\n        conditions: this.state.conditions,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/tradeRequests\",\n      render: props => React.createElement(TradeList, Object.assign({}, props, {\n        user: this.state.user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/myAds\",\n      render: props => React.createElement(MyAds, Object.assign({}, props, {\n        user: this.state.user,\n        getAds: this.filterUserAds,\n        categories: this.state.categories,\n        subCategories: this.state.subCategories,\n        conditions: this.state.conditions,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/adDetails/:id\",\n      component: AdDetails,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/newAdvertisement\",\n      render: props => React.createElement(NewAdvertisement, Object.assign({}, props, {\n        user: this.state.user,\n        categories: this.state.categories,\n        subCategories: this.state.subCategories,\n        conditions: this.state.conditions,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }), React.createElement(Route, {\n      component: PageNotFound,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    })), React.createElement(Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["C:\\Users\\JFrancisco\\Documents\\tum-market\\src\\components\\Home.js"],"names":["React","Component","firebase","Switch","Route","Navbar","Footer","Marketplace","AdDetails","PageNotFound","NewAdvertisement","TradeList","MyAds","Home","constructor","props","filterUserAds","ads","state","user","undefined","Object","values","length","id","info","advertisements","filter","ad","userId","usersList","sug","categories","subCategories","conditions","getUser","bind","getUsers","getAdvertisements","getCategories","getSubCategories","getConditions","search","componentDidMount","catch","err","console","log","componentWillUnmount","usersRef","off","adsRef","categoriesRef","subCategoriesRef","conditionsRef","userRef","userAdsRef","userBuyReqRef","userTradeReqRefSent","userTradeReqRefReceived","uid","database","ref","child","on","snap","val","stateObj","setState","buyReq","data","forEach","ss","push","tradeReq","receivedOffers","currentUser","cb","Promise","resolve","reject","keys","conRef","conditionId","cond","condition","ownerRef","mainCatRef","mainCategoryId","cat","mainCat","mainCategory","subCatRef","subCategoryId","sub","subCat","subCategory","input","target","value","forceUpdate","regix","RegExp","test","title","render","background"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport firebase from '../config/firebaseConfig';\r\nimport { Switch, Route } from 'react-router-dom'\r\nimport Navbar from './Navbar'\r\nimport Footer from './Footer'\r\nimport Marketplace from './advertisement/Marketplace'\r\nimport AdDetails from './advertisement/AdDetails'\r\nimport PageNotFound from './PageNotFound'\r\nimport NewAdvertisement from \"./advertisement/NewAdvertisement\"\r\nimport TradeList from './trade/TradeList'\r\nimport MyAds from './advertisement/MyAds'\r\n\r\nclass Home extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      user: {},\r\n      usersList: {},\r\n      advertisements: {},\r\n      sug: {},\r\n      categories: {},\r\n      subCategories: {},\r\n      conditions: {}\r\n    }\r\n\r\n    this.getUser = this.getUser.bind(this)\r\n    this.getUsers = this.getUsers.bind(this)\r\n    this.getAdvertisements = this.getAdvertisements.bind(this)\r\n    this.getCategories = this.getCategories.bind(this)\r\n    this.getSubCategories = this.getSubCategories.bind(this)\r\n    this.getConditions = this.getConditions.bind(this)\r\n    this.search = this.search.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getUsers()\r\n    this.getCategories()\r\n    this.getSubCategories()\r\n    this.getConditions()\r\n    this.getAdvertisements(this.props.user, this.getUser)\r\n      .catch(function (err) { console.log(err) })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.usersRef.off('value')\r\n    this.usersRef = null;\r\n\r\n    this.adsRef.off('value')\r\n    this.adsRef = null;\r\n\r\n    this.categoriesRef.off('value')\r\n    this.categoriesRef = null;\r\n\r\n    this.subCategoriesRef.off('value')\r\n    this.subCategoriesRef = null;\r\n\r\n    this.conditionsRef.off('value')\r\n    this.conditionsRef = null;\r\n\r\n    this.userRef.off('value')\r\n    this.userRef = null;\r\n\r\n    this.userAdsRef.off('value')\r\n    this.userAdsRef = null;\r\n\r\n    this.userBuyReqRef.off('value')\r\n    this.userBuyReqRef = null;\r\n\r\n    this.userTradeReqRefSent.off('value')\r\n    this.userTradeReqRefSent = null;\r\n\r\n    this.userTradeReqRefReceived.off('value')\r\n    this.userTradeReqRefReceived = null;\r\n  }\r\n\r\n  getUser(user) {\r\n    if (user !== undefined) {\r\n      const id = user.uid;\r\n\r\n      this.userRef = firebase.database().ref('users').child(id)\r\n      this.userRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.info = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userAdsRef = firebase.database().ref('advertisements').child(id)\r\n      this.userAdsRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.ads = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userBuyReqRef = firebase.database().ref('buying-requests').child(id)\r\n      this.userBuyReqRef.on('value', snap => {\r\n        let val = snap.val();\r\n        let stateObj = this.state.user;\r\n        stateObj.buyReq = val;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      })\r\n\r\n      this.userTradeReqRefSent = firebase.database().ref('trade-requests').child(id)\r\n      this.userTradeReqRefSent.on('value', snap => {\r\n        var data = [];\r\n        snap.forEach(ss => {\r\n          data.push(ss.val());\r\n        });\r\n\r\n        let stateObj = this.state.user;\r\n        stateObj.tradeReq = data;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n\r\n      this.userTradeReqRefReceived = firebase.database().ref('received-offers').child(id)\r\n      this.userTradeReqRefReceived.on('value', snap => {\r\n        var data = [];\r\n        snap.forEach(ss => {\r\n          data.push(ss.val());\r\n        });\r\n\r\n        let stateObj = this.state.user;\r\n        stateObj.receivedOffers = data;\r\n        this.setState({\r\n          user: stateObj\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  getUsers() {\r\n    this.usersRef = firebase.database().ref('users')\r\n    this.usersRef.on('value', snap => {\r\n      this.setState({\r\n        usersList: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getAdvertisements(currentUser, cb) {\r\n    return new Promise((resolve, reject) => {\r\n      this.adsRef = firebase.database().ref('advertisements')\r\n      this.adsRef.on('value', snap => {\r\n        let data = snap.val();\r\n        let ads = [];\r\n        if (data !== null && data !== undefined) {\r\n          Object.keys(data).forEach(function (user) {\r\n            Object.values(data[user]).forEach(function (ad) {\r\n              const conRef = firebase.database().ref('conditions').child(ad.conditionId);\r\n              conRef.on('value', cond => {\r\n                ad.condition = cond.val()\r\n              })\r\n\r\n              const ownerRef = firebase.database().ref('users').child(ad.userId);\r\n              ownerRef.on('value', user => {\r\n                ad.user = user.val()\r\n              })\r\n\r\n              const mainCatRef = firebase.database().ref('categories').child(ad.mainCategoryId);\r\n              mainCatRef.on('value', cat => {\r\n                const mainCat = cat.val()\r\n                ad.mainCategory = mainCat;\r\n                const subCatRef = firebase.database().ref('sub-categories').child(ad.mainCategoryId).child(ad.subCategoryId);\r\n                subCatRef.on('value', sub => {\r\n                  const subCat = sub.val();\r\n                  ad.subCategory = subCat;\r\n                })\r\n              })\r\n              ads.push(ad)\r\n            })\r\n          });\r\n        }\r\n\r\n        this.setState({\r\n          advertisements: ads,\r\n          sug: ads\r\n        })\r\n\r\n        if (this.state.advertisements.length !== undefined) {\r\n          resolve(cb(currentUser))\r\n        }\r\n        else {\r\n          reject('ads error')\r\n        }\r\n\r\n      })\r\n    })\r\n  }\r\n\r\n  getCategories() {\r\n    this.categoriesRef = firebase.database().ref('categories')\r\n    this.categoriesRef.on('value', snap => {\r\n      this.setState({\r\n        categories: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getSubCategories() {\r\n    this.subCategoriesRef = firebase.database().ref('sub-categories')\r\n    this.subCategoriesRef.on('value', snap => {\r\n      this.setState({\r\n        subCategories: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  getConditions() {\r\n    this.conditionsRef = firebase.database().ref('conditions')\r\n    this.conditionsRef.on('value', snap => {\r\n      this.setState({\r\n        conditions: snap.val()\r\n      })\r\n    })\r\n  }\r\n\r\n  search(input) {\r\n    if (input.target.value.length === 0)\r\n      this.setState({ sug: this.state.advertisements }, () => this.forceUpdate())\r\n    else {\r\n      const regix = new RegExp(`${input.target.value}`, 'i')\r\n      this.setState({ sug: this.state.advertisements.filter(ad => regix.test(ad.title)) }, () => this.forceUpdate())\r\n    }\r\n\r\n  }\r\n\r\n  filterUserAds = () => {\r\n    let ads = [];\r\n\r\n    if (this.state.user !== undefined && Object.values(this.state.user).length !== 0) {\r\n      const id = this.state.user.info.id\r\n      ads=Object.values(this.state.advertisements).filter(function (ad) {\r\n        return ad.userId === id;\r\n      });\r\n    }\r\n    return ads;\r\n\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"container\" style={{ background: \"#e9ebee\" }}>\r\n          <Navbar search={this.search} user={this.state.user} categories={this.state.categories} subCategories={this.state.subCategories} conditions={this.state.conditions} />\r\n          <Switch>\r\n            <Route exact path=\"/\" render={(props) => <Marketplace {...props} adsList={this.state.sug} user={this.state.user} categories={this.state.categories} subCategories={this.state.subCategories} conditions={this.state.conditions}/>} />\r\n            <Route path=\"/tradeRequests\" render={(props) => <TradeList {...props} user={this.state.user} />} />\r\n            <Route path=\"/myAds\" render={(props) => <MyAds {...props} user={this.state.user} getAds={this.filterUserAds} categories={this.state.categories} subCategories={this.state.subCategories} conditions={this.state.conditions}/>} />\r\n            <Route path=\"/adDetails/:id\" component={AdDetails} />\r\n            <Route path=\"/newAdvertisement\" render={(props) => <NewAdvertisement {...props} user={this.state.user} categories={this.state.categories} subCategories={this.state.subCategories} conditions={this.state.conditions} />} />\r\n            <Route component={PageNotFound} />\r\n          </Switch>\r\n          <Footer />\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}